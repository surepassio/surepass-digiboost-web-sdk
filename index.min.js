(() => {
	(function () {
		window.DigiboostSdk = function ({gateway: u, token: y, onSuccess: c, onFailure: r, selector: g, style: b}) {
			let d = "https://digilocker-sdk.notbot.in",
				w = `${d}/?gateway=${u}&type=digilocker&token=${y}&auth_type=web`, e = document.createElement("button");
			e.innerText = "Verify with DigiLocker";
			let k = {
				padding: "10px 20px",
				backgroundColor: "#613AF5",
				color: "#fff",
				border: "none",
				borderRadius: "6px",
				cursor: "pointer",
				width: "100%"
			};
			Object.assign(e.style, k, b || {});

			function a(t) {e.disabled = !1, e.innerText = t, e.style.opacity = "1", e.style.cursor = "pointer"}

			let f = !1;
			e.addEventListener("click", () => {
				let t = e.innerText;
				e.disabled = !0, e.innerText = "Verifying...", e.style.opacity = "0.7", e.style.cursor = "not-allowed";
				let n = window.open(w, "_blank"),
					l = setInterval(() => {(!n || n.closed) && (clearInterval(l), setTimeout(() => {!f && typeof r == "function" && r("Tab closed by user"), a(t)}, 100))}, 1e3);

				function s(i) {
					if(i.origin !== d) return;
					let {type: o, data: p} = i.data || {};
					o === "digilocker:complete" ? (f = !0, typeof c == "function" && c(p)) : o === "digilocker:failed" && typeof r == "function" && r(p), a(t), window.removeEventListener("message", s)
				}

				window.addEventListener("message", s)
			});

			function m(t, n, l = 10) {
				let s = 0, i = setInterval(() => {
					let o = document.querySelector(t);
					o ? (clearInterval(i), n(o)) : ++s >= l && (clearInterval(i), console.warn(`\u274C DigiLockerSDK: Could not find ${t} after ${l} attempts`), n(null))
				}, 500)
			}

			m(g, t => {t ? t.appendChild(e) : document.body.appendChild(e)})
		}
	})();
})();
